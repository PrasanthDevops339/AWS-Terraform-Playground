rule efsIsEncrypted when resourceType == "AWS::EFS::FileSystem" {
    configuration.Encrypted == true <<EFS file systems must be encrypted>>
}

rule efsHasRequiredTags when resourceType == "AWS::EFS::FileSystem" {
    let required_tags = ["ops:backupschedule1", "ops:backupschedule2", "Environment", "Owner", "Application"]
    
    configuration.tags exists
    configuration.tags.* {
        key in %required_tags
    }
    <<EFS file systems must have all required tags>>
}

rule efsHasValidPerformanceMode when resourceType == "AWS::EFS::FileSystem" {
    let valid_modes = ["generalPurpose", "maxIO"]
    
    configuration.PerformanceMode in %valid_modes
    <<EFS performance mode must be generalPurpose or maxIO>>
}

rule efsHasValidEnvironmentTag when resourceType == "AWS::EFS::FileSystem" {
    let valid_environments = ["dev", "staging", "production", "test"]
    
    when configuration.tags exists {
        some configuration.tags[*] {
            key == "Environment"
            value in %valid_environments
        }
    }
    <<EFS Environment tag must be one of: dev, staging, production, test>>
}
