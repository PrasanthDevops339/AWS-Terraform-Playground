# AMI Governance - Architecture Diagrams

## High-Level Design (HLD)

### System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS Organization                                      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Organization Root / OUs                                                   â”‚â”‚
â”‚  â”‚                                                                           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚  â”‚ Security/Ops OU  â”‚  â”‚ Workload OU      â”‚  â”‚ Workload OU      â”‚     â”‚â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚ (Dev)            â”‚  â”‚ (Production)     â”‚     â”‚â”‚
â”‚  â”‚  â”‚ âœ“ Golden AMI     â”‚  â”‚                  â”‚  â”‚                  â”‚     â”‚â”‚
â”‚  â”‚  â”‚   Publisher      â”‚  â”‚ âœ— No AMI         â”‚  â”‚ âœ— No AMI         â”‚     â”‚â”‚
â”‚  â”‚  â”‚ âœ“ Can create AMIsâ”‚  â”‚   creation       â”‚  â”‚   creation       â”‚     â”‚â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚ âœ“ Use approved   â”‚  â”‚ âœ“ Use approved   â”‚     â”‚â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚   AMIs only      â”‚  â”‚   AMIs only      â”‚     â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚          â”‚                       â”‚                      â”‚               â”‚â”‚
â”‚  â”‚          â”‚                       â”‚                      â”‚               â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚              AWS Organizations Policies                          â”‚  â”‚â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ Declarative Policy (EC2)                                     â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Image Block Public Access: block_new_sharing               â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Allowed Images: approved publishers only                   â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Applied: Organization Root (all accounts)                  â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ Service Control Policy (SCP)                                 â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Deny RunInstances with unapproved AMI owner                â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Deny CreateImage, CopyImage, RegisterImage, ImportImage    â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Deny ModifyImageAttribute (sharing)                        â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Applied: Workload OUs only                                 â”‚â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”‚
                                    â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Control Enforcement  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ EC2 Launch Control â”‚  â”‚ AMI Block â”‚  â”‚ AMI Creation  â”‚
        â”‚                    â”‚  â”‚ Sharing   â”‚  â”‚ Prevention    â”‚
        â”‚ âœ“ Approved AMIs    â”‚  â”‚           â”‚  â”‚               â”‚
        â”‚   123456738923     â”‚  â”‚ âœ“ No new  â”‚  â”‚ âœ— CreateImage â”‚
        â”‚   111122223333     â”‚  â”‚   public  â”‚  â”‚ âœ— CopyImage   â”‚
        â”‚   444455556666     â”‚  â”‚   AMIs    â”‚  â”‚ âœ— RegisterImageâ”‚
        â”‚   [exceptions]     â”‚  â”‚           â”‚  â”‚ âœ— ImportImage â”‚
        â”‚                    â”‚  â”‚           â”‚  â”‚               â”‚
        â”‚ âœ— Custom AMIs      â”‚  â”‚           â”‚  â”‚               â”‚
        â”‚ âœ— Public AMIs      â”‚  â”‚           â”‚  â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Control Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Application Team Action                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Launch Instanceâ”‚  â”‚ Create   â”‚  â”‚ Share AMI    â”‚
            â”‚ RunInstances   â”‚  â”‚ AMI      â”‚  â”‚ Publicly     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Check AMI      â”‚  â”‚ Check    â”‚  â”‚ Check Block  â”‚
            â”‚ Owner          â”‚  â”‚ SCP      â”‚  â”‚ Public Accessâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                â”‚
         â”‚          â”‚        â”‚       â”‚                â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚Approvedâ”‚ â”‚Exceptedâ”‚  â”‚  â”‚  Denied  â”‚     â”‚  Denied  â”‚
    â”‚Owner   â”‚ â”‚Account â”‚  â”‚  â”‚          â”‚     â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚         â”‚        â”‚       â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                â”‚
               â”‚                    â”‚                â”‚
          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚ ALLOWED â”‚          â”‚ DENIED   â”‚     â”‚ DENIED   â”‚
          â”‚         â”‚          â”‚          â”‚     â”‚          â”‚
          â”‚ Launch  â”‚          â”‚ Error    â”‚     â”‚ Error    â”‚
          â”‚ Success â”‚          â”‚ Message  â”‚     â”‚ Message  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Low-Level Design (LLD)

### Declarative Policy Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AWS Organizations Declarative Policy (EC2)                                 â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ image_block_public_access_policy                                      â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   statement:                                                           â”‚â”‚
â”‚  â”‚     block_public_access_value:                                         â”‚â”‚
â”‚  â”‚       @operator: string_equals                                         â”‚â”‚
â”‚  â”‚       @value: "block_new_sharing"                                      â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Prevents any new AMIs from being made public                â”‚â”‚
â”‚  â”‚   Scope: All accounts in organization                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ allowed_images_settings_policy                                         â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   statement:                                                           â”‚â”‚
â”‚  â”‚     discover_allowed_image_providers:                                  â”‚â”‚
â”‚  â”‚       enforcement_mode:                                                â”‚â”‚
â”‚  â”‚         @operator: string_equals                                       â”‚â”‚
â”‚  â”‚         @value: "enabled" | "audit_mode"                               â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚       allowed_image_providers:                                         â”‚â”‚
â”‚  â”‚         @operator: for_all_values:string_equals                        â”‚â”‚
â”‚  â”‚         @value:                                                        â”‚â”‚
â”‚  â”‚           - "123456738923"  # Ops Golden AMIs                          â”‚â”‚
â”‚  â”‚           - "111122223333"  # InfoBlox                                 â”‚â”‚
â”‚  â”‚           - "444455556666"  # Terraform Enterprise                     â”‚â”‚
â”‚  â”‚           - "777788889999"  # Exception (expires 2026-02-28)           â”‚â”‚
â”‚  â”‚           - "222233334444"  # Exception (expires 2026-03-15)           â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚       exception_message:                                               â”‚â”‚
â”‚  â”‚         @value: "AMI Launch Denied: [full message]"                    â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Restricts AMI discovery/use to approved publishers          â”‚â”‚
â”‚  â”‚   Scope: All accounts in organization                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SCP Policy Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Control Policy (SCP)                                               â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Statement 1: DenyEC2LaunchWithUnapprovedAMI                           â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Deny                                                         â”‚â”‚
â”‚  â”‚   Actions:                                                             â”‚â”‚
â”‚  â”‚     - ec2:RunInstances                                                 â”‚â”‚
â”‚  â”‚     - ec2:CreateFleet                                                  â”‚â”‚
â”‚  â”‚     - ec2:RequestSpotInstances                                         â”‚â”‚
â”‚  â”‚     - ec2:RequestSpotFleet                                             â”‚â”‚
â”‚  â”‚     - autoscaling:CreateLaunchConfiguration                            â”‚â”‚
â”‚  â”‚     - autoscaling:CreateAutoScalingGroup                               â”‚â”‚
â”‚  â”‚     - autoscaling:UpdateAutoScalingGroup                               â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Resource: "*"                                                        â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Condition:                                                           â”‚â”‚
â”‚  â”‚     StringNotEquals:                                                   â”‚â”‚
â”‚  â”‚       ec2:Owner:                                                       â”‚â”‚
â”‚  â”‚         - "123456738923"                                               â”‚â”‚
â”‚  â”‚         - "111122223333"                                               â”‚â”‚
â”‚  â”‚         - "444455556666"                                               â”‚â”‚
â”‚  â”‚         - "777788889999" # Exception                                   â”‚â”‚
â”‚  â”‚         - "222233334444" # Exception                                   â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Blocks instance launches with AMIs from non-approved owners â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Statement 2: DenyAMICreation                                          â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Deny                                                         â”‚â”‚
â”‚  â”‚   Actions:                                                             â”‚â”‚
â”‚  â”‚     - ec2:CreateImage                                                  â”‚â”‚
â”‚  â”‚     - ec2:CopyImage                                                    â”‚â”‚
â”‚  â”‚     - ec2:RegisterImage                                                â”‚â”‚
â”‚  â”‚     - ec2:ImportImage                                                  â”‚â”‚
â”‚  â”‚     - ec2:ImportSnapshot                                               â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Resource: "*"                                                        â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Prevents app teams from creating/importing AMIs             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Statement 3: DenyAMISharing                                           â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Deny                                                         â”‚â”‚
â”‚  â”‚   Actions:                                                             â”‚â”‚
â”‚  â”‚     - ec2:ModifyImageAttribute                                         â”‚â”‚
â”‚  â”‚     - ec2:ModifySnapshotAttribute                                      â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Resource: "*"                                                        â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Condition:                                                           â”‚â”‚
â”‚  â”‚     StringLike:                                                        â”‚â”‚
â”‚  â”‚       ec2:Attribute:                                                   â”‚â”‚
â”‚  â”‚         - "launchPermission"                                           â”‚â”‚
â”‚  â”‚         - "createVolumePermission"                                     â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚   Effect: Prevents modification of AMI/snapshot sharing permissions   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Exception Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Exception Lifecycle                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Request
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  App Team
     â”‚
     â”‚ Submit ServiceNow ticket
     â”‚ â€¢ Business justification
     â”‚ â€¢ Account ID
     â”‚ â€¢ Duration (max 90 days)
     â”‚ â€¢ Security review
     â–¼
  SNOW-CATALOG-AMI-EXCEPTION
     â”‚
     â””â”€â”€â–º Approval Workflow


Step 2: Approval
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Security Team (2 days)
     â”‚
     â”œâ”€â”€â–º Review security scan
     â”œâ”€â”€â–º Assess risk
     â””â”€â”€â–º Approve/Reject
            â”‚
            â–¼
  Platform Team (2 days)
     â”‚
     â”œâ”€â”€â–º Technical review
     â”œâ”€â”€â–º Verify alternatives
     â””â”€â”€â–º Approve/Reject
            â”‚
            â–¼
  Chief Architect (if >30 days)
     â”‚
     â””â”€â”€â–º Strategic review
            â”‚
            â–¼
        APPROVED


Step 3: Implementation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Platform Engineer
     â”‚
     â”‚ 1. Create git branch
     â”‚ 2. Update variables.tf:
     â”‚    exception_accounts = {
     â”‚      "777788889999" = "2026-02-28"
     â”‚    }
     â”‚ 3. Terraform plan/apply
     â”‚ 4. Create PR
     â”‚ 5. Merge after review
     â–¼
  Policy Updated
     â”‚
     â”œâ”€â”€â–º Declarative Policy: adds to allowed_image_providers
     â”œâ”€â”€â–º SCP: adds to ec2:Owner condition
     â””â”€â”€â–º SSM Parameter: tracks expiry date


Step 4: Active Monitoring
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Daily CI/CD Pipeline
     â”‚
     â”‚ Check exception expiry dates
     â”‚
     â”œâ”€â”€â–º 14 days before: Warning email
     â”œâ”€â”€â–º 7 days before: Urgent email
     â”œâ”€â”€â–º 1 day before: Critical alert
     â”‚
     â–¼
  Expiry Date Reached
     â”‚
     â”œâ”€â”€â–º GitHub Issue created
     â”œâ”€â”€â–º SNS notification sent
     â”œâ”€â”€â–º Slack alert posted
     â””â”€â”€â–º Exception flagged for removal


Step 5: Removal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Platform Engineer
     â”‚
     â”‚ 1. Verify expiry
     â”‚ 2. Notify app team (final warning)
     â”‚ 3. Create git branch
     â”‚ 4. Remove from variables.tf
     â”‚ 5. Terraform plan/apply
     â”‚ 6. Create PR
     â”‚ 7. Merge after review
     â–¼
  Exception Removed
     â”‚
     â””â”€â”€â–º App team can no longer use non-approved AMIs
```

### Terraform Module Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Terraform Module                                    â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ INPUTS (variables.tf)                                                 â”‚â”‚
â”‚  â”‚                                                                        â”‚â”‚
â”‚  â”‚  â€¢ org_root_or_ou_ids: [r-abcd]                                       â”‚â”‚
â”‚  â”‚  â€¢ approved_ami_owner_accounts: [123456738923, ...]                   â”‚â”‚
â”‚  â”‚  â€¢ exception_accounts: {"777788889999" => "2026-02-28"}               â”‚â”‚
â”‚  â”‚  â€¢ policy_mode: "enabled" | "audit_mode"                              â”‚â”‚
â”‚  â”‚  â€¢ workload_ou_ids: [ou-abcd-11111111, ...]                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                   â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LOCALS (main.tf)                                                    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  current_date = timestamp()                                         â”‚  â”‚
â”‚  â”‚       â”‚                                                             â”‚  â”‚
â”‚  â”‚       â–¼                                                             â”‚  â”‚
â”‚  â”‚  active_exceptions = filter exceptions where expiry >= current_dateâ”‚  â”‚
â”‚  â”‚       â”‚                                                             â”‚  â”‚
â”‚  â”‚       â–¼                                                             â”‚  â”‚
â”‚  â”‚  all_allowed_ami_owners = approved_accounts + active_exceptions    â”‚  â”‚
â”‚  â”‚       â”‚                                                             â”‚  â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚                             â”‚                                      â”‚  â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚  â”‚
â”‚  â”‚ RESOURCES                                                       â”‚â”‚  â”‚  â”‚
â”‚  â”‚                                                                 â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ aws_organizations_policy.ami_declarative_policy            â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   content = jsonencode({                                   â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     policies = {                                           â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       image_block_public_access_policy = {...}             â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       allowed_images_settings_policy = {                   â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         allowed_image_providers = all_allowed_ami_owners   â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       }                                                     â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     }                                                       â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   })                                                        â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚  â”‚  â”‚
â”‚  â”‚                                                                 â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ aws_organizations_policy.ami_scp_policy                    â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   content = jsonencode({                                   â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     Statement = [                                          â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       Deny RunInstances if ec2:Owner not in:               â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         all_allowed_ami_owners                             â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       Deny CreateImage, CopyImage, etc.                    â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     ]                                                       â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   })                                                        â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚  â”‚  â”‚
â”‚  â”‚                                                                 â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ aws_organizations_policy_attachment (declarative)          â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   for_each = org_root_or_ou_ids                            â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   target_id = each.value                                   â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚  â”‚  â”‚
â”‚  â”‚                                                                 â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ aws_organizations_policy_attachment (SCP)                  â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   for_each = workload_ou_ids                               â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   target_id = each.value                                   â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚  â”‚  â”‚
â”‚  â”‚                                                                 â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ aws_ssm_parameter.ami_exceptions                           â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   value = {                                                â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     active_exceptions = {...}                              â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     expired_exceptions = {...}                             â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   }                                                         â”‚â”‚â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  â”‚
â”‚                                                                      â”‚  â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”‚
â”‚  â”‚ OUTPUTS (outputs.tf)                                                 â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â€¢ declarative_policy_id                                            â”‚ â”‚
â”‚  â”‚  â€¢ scp_policy_id                                                    â”‚ â”‚
â”‚  â”‚  â€¢ approved_ami_owners (combined list)                              â”‚ â”‚
â”‚  â”‚  â€¢ active_exceptions (filtered map)                                 â”‚ â”‚
â”‚  â”‚  â€¢ expired_exceptions (filtered map)                                â”‚ â”‚
â”‚  â”‚  â€¢ policy_summary (statistics)                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Control Point Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Control Point Analysis                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Action         â”‚ Control              â”‚ Enforcement Point                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RunInstances   â”‚ SCP + Declarative    â”‚ 1. SCP checks ec2:Owner          â”‚
â”‚                â”‚                      â”‚ 2. Declarative checks allowed     â”‚
â”‚                â”‚                      â”‚    image providers                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CreateFleet    â”‚ SCP                  â”‚ SCP checks ec2:Owner              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RequestSpot    â”‚ SCP                  â”‚ SCP checks ec2:Owner              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CreateImage    â”‚ SCP                  â”‚ SCP denies unconditionally        â”‚
â”‚                â”‚                      â”‚ (workload OUs only)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CopyImage      â”‚ SCP                  â”‚ SCP denies unconditionally        â”‚
â”‚                â”‚                      â”‚ (workload OUs only)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RegisterImage  â”‚ SCP                  â”‚ SCP denies unconditionally        â”‚
â”‚                â”‚                      â”‚ (workload OUs only)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ImportImage    â”‚ SCP                  â”‚ SCP denies unconditionally        â”‚
â”‚                â”‚                      â”‚ (workload OUs only)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ModifyImage    â”‚ SCP                  â”‚ SCP denies if attribute is        â”‚
â”‚ Attribute      â”‚                      â”‚ launchPermission                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Make AMI       â”‚ Declarative          â”‚ image_block_public_access         â”‚
â”‚ Public         â”‚                      â”‚ prevents new public sharing       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Exception Expiry Timeline

```
Exception Created: 2026-01-15
Exception Expires: 2026-02-28 (45 days)

Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

2026-01-15     2026-02-14        2026-02-21        2026-02-27   2026-02-28
    â”‚              â”‚                 â”‚                 â”‚            â”‚
    â”‚              â”‚                 â”‚                 â”‚            â”‚
 Created      -14 days          -7 days           -1 day      EXPIRED
    â”‚              â”‚                 â”‚                 â”‚            â”‚
    â–¼              â–¼                 â–¼                 â–¼            â–¼
    
âœ“ Active      ğŸ“§ Warning       âš ï¸  Urgent        ğŸš¨ Critical   âŒ BLOCKED
              Email sent       Email + Slack     All channels  Access denied
                              notification      alerted       

                                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                              â”‚ +3 days:    â”‚
                                                              â”‚ Escalate to â”‚
                                                              â”‚ leadership  â”‚
                                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated**: 2026-01-03  
**Version**: 1.0  
**Owner**: Platform Engineering Team
